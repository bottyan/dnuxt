(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{246:function(e,t,n){var content=n(253);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(70).default)("d7ffd670",content,!0,{sourceMap:!1})},251:function(e,t,n){e.exports=function(){"use strict";function e(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)e[t]=source[t]}return e}function t(n,o){function r(t,r,c){if("undefined"!=typeof document){"number"==typeof(c=e({},o,c)).expires&&(c.expires=new Date(Date.now()+864e5*c.expires)),c.expires&&(c.expires=c.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var d="";for(var l in c)c[l]&&(d+="; "+l,!0!==c[l]&&(d+="="+c[l].split(";")[0]));return document.cookie=t+"="+n.write(r,t)+d}}function c(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],o={},i=0;i<t.length;i++){var r=t[i].split("="),c=r.slice(1).join("=");try{var d=decodeURIComponent(r[0]);if(o[d]=n.read(c,d),e===d)break}catch(e){}}return e?o[e]:o}}return Object.create({set:r,get:c,remove:function(t,n){r(t,"",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(n)}})}return t({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},252:function(e,t,n){"use strict";n(246)},253:function(e,t,n){var o=n(69)(!1);o.push([e.i,'.chat-block[data-v-5ab31c5d]{min-height:100vh;position:relative}.chat-block .content .msg-line .msg-user[data-v-5ab31c5d],.chat-block .content .msg-line .msg-user-resp[data-v-5ab31c5d]{text-align:right}.input-holder[data-v-5ab31c5d]{min-height:5rem;padding-bottom:2rem;position:-webkit-sticky;position:sticky;bottom:0}.input-holder .input-box[data-v-5ab31c5d]{padding:2rem;border-radius:1rem;background:#fff;border:2px solid #000;box-shadow:1rem 1rem 4px 0 rgba(0,0,0,.72)}.input-holder .input-box input[data-v-5ab31c5d]{width:calc(100% - 8px);border:solid #000;border-width:0 0 1px}.input-holder .input-box .choice-form .option-title[data-v-5ab31c5d]{margin-bottom:0}.input-holder .input-box .choice-form .option[data-v-5ab31c5d]{display:inline-block;margin-right:1rem;margin-top:1rem;border-radius:.5rem;overflow:hidden}.input-holder .input-box .choice-form .option .option-body[data-v-5ab31c5d]{background:#add8e6;font-size:1.5rem;line-height:1.2em;padding:1rem;cursor:pointer}.input-holder .input-box .choice-form .option[data-v-5ab31c5d]:hover{box-shadow:.2rem .2rem 2px 0 rgba(0,0,0,.32)}.messages[data-v-5ab31c5d]{flex:1 1 auto;overflow:hidden;position:relative;width:100%}.messages .messages-content[data-v-5ab31c5d]{position:relative;top:0;left:0;height:101%;width:100%}.messages .message[data-v-5ab31c5d]{clear:both;float:left;padding:1rem;border-radius:10px 10px 10px 0;background:linear-gradient(120deg,rgba(0,160,176,.3),rgba(245,223,77,.3));font-size:1.5rem;line-height:1.2em;margin:8px 0 8px 35px;position:relative}.messages .message .timestamp[data-v-5ab31c5d]{position:absolute;bottom:-15px;font-size:9px;color:hsla(0,0%,100%,.3)}.messages .message[data-v-5ab31c5d]:before{content:"";position:absolute;bottom:-6px;border-top:6px solid rgba(0,160,176,.3);left:0;border-right:7px solid transparent}.messages .message .avatar[data-v-5ab31c5d]{position:absolute;z-index:1;bottom:-15px;left:-35px;border-radius:30px;width:30px;height:30px;overflow:hidden;margin:0;padding:0;border:2px solid hsla(0,0%,100%,.24)}.messages .message .avatar img[data-v-5ab31c5d]{width:100%;height:auto}.messages .message.message-personal[data-v-5ab31c5d]{float:right;color:#fff;text-align:right;background:linear-gradient(120deg,#248a52,#257287);border-radius:10px 10px 0 10px}.messages .message.message-personal[data-v-5ab31c5d]:before{left:auto;right:0;border-right:none;border-left:5px solid transparent;border-top:4px solid #257287;bottom:-4px}.messages .message[data-v-5ab31c5d]:last-child{margin-bottom:30px}.messages .message.new[data-v-5ab31c5d]{transform:scale(0);transform-origin:0 0;-webkit-animation:bounce .5s linear both;animation:bounce .5s linear both}',""]),e.exports=o},284:function(t,n,o){"use strict";o.r(n);o(43),o(26),o(44),o(30),o(25),o(45),o(46),o(31);var r=o(23),c=(o(47),o(14),o(71),o(251)),d=o.n(c);function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){d=!0,r=e})),f:function(){try{c||null==n.return||n.return()}finally{if(d)throw r}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var f={layout:"dialogity",data:function(){return{connection:null,floatingMessage:null,uuid:null,cid:null,messages:[]}},mounted:function(){this.gsapInit(),console.log("Starting connection to WebSocket Server");var t="d09fbd61d20c42de9023c7a8f2b0154e",n=d.a.get("wtid");n&&""!==n||(n=this.dlgty_chb_guidGenerator(),d.a.set("wtid",n)),this.connection=new WebSocket("wss://api2.dialogity.com/ws/chat");var o=this.connection,r=this;this.connection.onmessage=function(e){console.log("Message received:",e);var data=JSON.parse(e.data);"messages"===data.command?(console.log("Messages fetched:",data.messages),r.setMessages(data.messages)):"new_message"===data.command?r.addMessage(data.message):"update_message"===data.command&&r.updateMessage(data.message)},this.connection.onopen=function(e){console.log(e),console.log("Successfully connected to the websocket server..."),o.send(JSON.stringify({command:"fetch_messages",uuid:t,cid:n,url:"chatbot"}))},this.connection.onclose=function(t){console.log("Socket is closed. Reconnect will be attempted in 1 ms.",e.reason),setTimeout((function(){connect()}),1)},this.cid=n,this.uuid=t},beforeDestroy:function(){},methods:{sendMsg:function(e){},clickOption:function(e,t){var n={command:"new_answer",message:{option:t},system_message:2,type:1,cid:this.cid,uuid:this.uuid,qid:e,lang:this.lang,url:"chatbot"};this.connection.send(JSON.stringify(n))},onEnter:function(e){var t,n=e.target.value;console.log("On Enter:",n),e.target.value="",this.connection.send(JSON.stringify((t={command:"new_message",message:n,type:1,cid:this.cid,uuid:this.uuid,lang:"ENG",is_html:0},Object(r.a)(t,"uuid",this.uuid),Object(r.a)(t,"cid",this.cid),Object(r.a)(t,"url","chatbot"),t)))},setMessages:function(e){console.log("MESSAGES"),this.messages=e,this.getFloatingMessage(),this.scrollToTheEnd()},addMessage:function(e){this.messages.push(e),this.getFloatingMessage(),this.scrollToTheEnd()},updateMessage:function(e){if(this.messages){for(var i=0;i<this.messages.length;i++)e.id===this.messages[i].id&&(this.messages[i].body=e.body,this.messages[i].system_message=e.system_message,this.messages[i].floating=e.floating);this.scrollToTheEnd()}else console.log("WARN: updateMessage failed because messages is empty")},getFloatingMessage:function(){this.floatingMessage=null;var e,t=l(this.messages);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.floating&&(this.floatingMessage=n)}}catch(e){t.e(e)}finally{t.f()}},getSelectedMessage:function(e,t){var n,o="",r=l(e);try{for(r.s();!(n=r.n()).done;){var option=n.value;option.id==t&&(o=option.text)}}catch(e){r.e(e)}finally{r.f()}return console.log("OPTION SELECTED:",o),o},dlgty_chb_guidGenerator:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},scrollToTheEnd:function(){var e=this;this.$nextTick((function(){var t=e.$refs.containeToScroll.clientHeight,n=e.$refs.inputHolder.getBoundingClientRect().top;if(console.log("SCROLL",t,n),t>n){var o=Math.max(0,t-n);console.log("scroll to:",o),window.scrollTo(0,o)}}))},gsapInit:function(){}}},h=(o(252),o(29)),component=Object(h.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{ref:"containeToScroll",staticClass:"chat-block max-width headspace"},[n("div",{staticClass:"content messages",attrs:{id:"content"}},[n("div",{staticClass:"messages-content"},e._l(e.messages,(function(t){return n("div",{key:t.id,staticClass:"msg-line"},[t.floating?e._e():n("div",[2==t.type&&t.body.option?n("div",{staticClass:"msg-user-resp message message-personal"},[e._v("\n              "+e._s(e.getSelectedMessage(t.body.options,t.body.option))+"\n            ")]):e._e(),e._v(" "),1==t.type&&0==t.system_message?n("div",{staticClass:"msg-user message message-personal"},[e._v("\n              "+e._s(t.body_str)+"\n            ")]):e._e(),e._v(" "),0==t.type||2==t.type&&0==t.system_message?n("div",{staticClass:"msg-bot message"},[0==t.is_html?n("div",[e._v("\n                "+e._s(t.body)+"\n              ")]):e._e(),e._v(" "),1==t.is_html?n("div",[n("span",{domProps:{innerHTML:e._s(t.body)}})]):e._e()]):e._e()])])})),0)])]),e._v(" "),n("div",{ref:"inputHolder",staticClass:"input-holder sticky",attrs:{id:"inputHolder"}},[n("div",{staticClass:"max-width"},[n("div",{staticClass:"input-box"},[e.floatingMessage?n("div",["choice"==e.floatingMessage.body.type?n("div",{staticClass:"choice-form"},[n("div",{staticClass:"option-title"},[e._v("Select an option 👇")]),e._v(" "),e._l(e.floatingMessage.body.options,(function(option){return n("div",{key:option.id,staticClass:"option"},[n("div",{staticClass:"option-body",on:{click:function(t){return e.clickOption(e.floatingMessage.id,option.id)}}},[e._v(e._s(option.text))])])}))],2):e._e()]):e._e(),e._v(" "),e.floatingMessage&&"choice"===e.floatingMessage.body.type?e._e():n("div",[n("input",{attrs:{id:"freeTextInput",type:"text"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnter.apply(null,arguments)}}})])])])]),e._v(" "),n("div",{staticClass:"footer"})])}),[],!1,null,"5ab31c5d",null);n.default=component.exports}}]);